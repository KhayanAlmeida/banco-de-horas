<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Banco de Horas - Completo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDizUpxR37FGDxBwSYwBaYLo8b4OOxF4kU",
      authDomain: "banco-de-horas-4d170.firebaseapp.com",
      projectId: "banco-de-horas-4d170",
      storageBucket: "banco-de-horas-4d170.firebasestorage.app",
      messagingSenderId: "746132039738",
      appId: "1:746132039738:web:0df10e223c9bea77392d03",
      measurementId: "G-12LSMBQV10"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const colFuncionarios = collection(db, "funcionarios");
    const colRegistros = collection(db, "registrosHoras");

    window.onload = () => {
      listarFuncionarios();
      listarRegistros();
    };

    window.salvarFuncionario = async () => {
      const nome = document.getElementById("nome").value;
      const cargo = document.getElementById("cargo").value;
      const id = document.getElementById("id").value;
      if (!nome || !cargo || !id) return alert("Preencha todos os campos!");
      await addDoc(colFuncionarios, { nome, cargo, id });
      alert("Funcionário salvo!");
      listarFuncionarios();
    };

    async function listarFuncionarios() {
      const lista = document.getElementById("lista-funcionarios");
      lista.innerHTML = "";
      const snapshot = await getDocs(colFuncionarios);
      snapshot.forEach(doc => {
        const f = doc.data();
        const li = document.createElement("li");
        li.className = "p-2 border-b";
        li.textContent = `${f.nome} (${f.id}) - ${f.cargo}`;
        lista.appendChild(li);
      });
    }

    window.registrarHoras = async () => {
      const id = document.getElementById("registro-id").value;
      const data = document.getElementById("registro-data").value;
      const horas = parseFloat(document.getElementById("registro-horas").value);
      const obs = document.getElementById("registro-obs").value;
      if (!id || !data || !horas || !obs) return alert("Preencha todos os campos!");
      await addDoc(colRegistros, {
        idFuncionario: id,
        data,
        horas,
        observacoes: obs,
        status: "Pendente",
        timestamp: Timestamp.now()
      });
      alert("Horas registradas!");
      listarRegistros();
    };

    async function listarRegistros() {
      const lista = document.getElementById("lista-registros");
      lista.innerHTML = "";
      let total = 0;
      const snapshot = await getDocs(colRegistros);
      snapshot.forEach(docSnap => {
        const r = docSnap.data();
        const div = document.createElement("div");
        div.className = "border p-2 rounded bg-white text-sm";

        div.innerHTML = `
          <p><b>ID:</b> ${r.idFuncionario} | <b>Data:</b> ${r.data}</p>
          <p><b>Horas:</b> ${r.horas} | <b>Status:</b> ${r.status}</p>
          <p><b>Obs:</b> ${r.observacoes}</p>
          <div class="flex gap-2 mt-2">
            <button onclick="confirmar('${docSnap.id}')" class="px-2 py-1 bg-blue-600 text-white rounded text-xs">Confirmar</button>
            <button onclick="excluir('${docSnap.id}')" class="px-2 py-1 bg-red-600 text-white rounded text-xs">Excluir</button>
          </div>
        `;

        lista.appendChild(div);
        if (r.status === "Confirmado") total += r.horas;
      });

      document.getElementById("total-confirmado").textContent = `Total Confirmado: ${total.toFixed(2)} horas`;
    }

    window.confirmar = async (id) => {
      const senha = prompt("Digite a senha de confirmação:");
      if (senha !== "admin123") return alert("Senha incorreta!");
      const ref = doc(db, "registrosHoras", id);
      await updateDoc(ref, { status: "Confirmado" });
      listarRegistros();
    };

    window.excluir = async (id) => {
      const ok = confirm("Tem certeza que deseja excluir este registro?");
      if (!ok) return;
      await deleteDoc(doc(db, "registrosHoras", id));
      listarRegistros();
    };
  </script>
</head>
<body class="bg-gray-100 p-4 text-gray-900">
  <div class="max-w-4xl mx-auto space-y-8">

    <section class="bg-white p-4 rounded shadow">
      <h2 class="text-lg font-bold mb-2">Cadastro de Funcionários</h2>
      <input id="nome" placeholder="Nome" class="border p-2 w-full mb-2" />
      <input id="cargo" placeholder="Cargo" class="border p-2 w-full mb-2" />
      <input id="id" placeholder="ID (ex: 01)" class="border p-2 w-full mb-2" />
      <button onclick="salvarFuncionario()" class="bg-blue-600 text-white px-4 py-2 rounded">Salvar</button>
      <ul id="lista-funcionarios" class="mt-4 list-disc pl-4 text-sm"></ul>
    </section>

    <section class="bg-white p-4 rounded shadow">
      <h2 class="text-lg font-bold mb-2">Registrar Horas</h2>
      <input id="registro-id" placeholder="ID do Funcionário" class="border p-2 w-full mb-2" />
      <input id="registro-data" type="date" class="border p-2 w-full mb-2" />
      <input id="registro-horas" type="number" step="0.1" placeholder="Horas (ex: 2.5)" class="border p-2 w-full mb-2" />
      <textarea id="registro-obs" placeholder="Observações" class="border p-2 w-full mb-2"></textarea>
      <button onclick="registrarHoras()" class="bg-green-600 text-white px-4 py-2 rounded">Registrar</button>
    </section>

    <section class="bg-white p-4 rounded shadow">
      <h2 class="text-lg font-bold mb-2">Histórico de Registros</h2>
      <p id="total-confirmado" class="text-sm text-gray-700 mb-2">Total Confirmado: 0 horas</p>
      <div id="lista-registros" class="space-y-2"></div>
    </section>

  </div>
</body>
</html>
